<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Game Design Code Share</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f172a;
      --panel:#111827;
      --muted:#94a3b8;
      --text:#e5e7eb;
      --border:#1f2937;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font:14px/1.5 Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial}
    .app{display:grid;grid-template-columns:320px 1fr;grid-template-rows:1fr;gap:0;height:100%}
    .sidebar{border-right:1px solid var(--border);overflow:auto}
    .viewer{overflow:auto}
    .tree{padding:8px}
    .tree-item{display:flex;align-items:center;gap:.5rem;padding:6px 8px;border-radius:8px;cursor:pointer}
    .tree-item:hover{background:#0b1220}
    .tree-item.active{background:#0b1220;outline:1px solid #1e293b}
    .tree-children{margin-left:16px}
    .code-wrap{padding:16px}
    pre{margin:0;}
    pre,code{font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:13px}
    .code-header{padding:10px 12px;background:#0b1220;border:1px solid var(--border);border-bottom:none;border-radius:12px 12px 0 0}
    .code-header .path{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .code-body{border:1px solid var(--border);border-radius:0 0 12px 12px;overflow:auto}
    .error{padding:12px;margin:8px;border:1px solid #7f1d1d;background:#450a0a;color:#fecaca;border-radius:8px}
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/csharp.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="tree" id="tree"></div>
    </aside>
    <main class="viewer">
      <div class="code-wrap">
        <div class="code-header">
          <div class="path" id="activePath">Choose a file from the left‚Ä¶</div>
        </div>
        <div class="code-body">
          <pre><code id="code" class="language-cs">// Your file will appear here.</code></pre>
        </div>
        <div id="error" class="error" style="display:none"></div>
      </div>
    </main>
  </div>

  <script>
    const $ = sel => document.querySelector(sel);
    const apiBase = (o,r)=>`https://api.github.com/repos/${encodeURIComponent(o)}/${encodeURIComponent(r)}`;
    const rawBase = (o,r,b)=>`https://raw.githubusercontent.com/${encodeURIComponent(o)}/${encodeURIComponent(r)}/${encodeURIComponent(b)}`;

    const owner = 'MasayaAUT';
    const repo = 'CodeShare';
    const branch = 'main';
    const rootPath = 'Scripts';

    const extToLang = (p)=>{
      const m = p.toLowerCase().match(/\.([a-z0-9]+)$/);
      const ext = m ? m[1] : '';
      const map = { cs:'csharp', json:'json', md:'markdown', shader:'glsl', hlsl:'glsl', cginc:'glsl', txt:'plaintext' };
      return map[ext] || 'plaintext';
    };

    async function ghGet(url){
      const res = await fetch(url, { headers: { 'Accept':'application/vnd.github+json' }});
      if(!res.ok){
        throw new Error(res.status + ' ' + res.statusText);
      }
      return res.json();
    }

    async function listTree(){
      const out = [];
      async function walk(path){
        const url = `${apiBase(owner,repo)}/contents/${path?encodeURIComponent(path):''}?ref=${encodeURIComponent(branch)}`;
        const items = await ghGet(url);
        for(const it of items){
          if(it.type === 'dir'){
            await walk(it.path);
          } else if(it.type === 'file'){
            out.push({ path: it.path, name: it.name, download_url: it.download_url });
          }
        }
      }
      await walk(rootPath);
      return out.sort((a,b)=>a.path.localeCompare(b.path));
    }

    function renderTree(files){
      const root = {};
      for(const f of files){
        const parts = f.path.split('/');
        let cur = root;
        for(let i=0;i<parts.length;i++){
          const part = parts[i];
          if(i===parts.length-1){
            cur[part] = { __file: f };
          } else {
            cur[part] = cur[part] || {};
            cur = cur[part];
          }
        }
      }
      const treeEl = $('#tree');
      treeEl.innerHTML='';

      function makeNode(obj, basePath=''){
        const keys = Object.keys(obj).sort();
        const container = document.createElement('div');
        container.className = 'tree-children';
        for(const key of keys){
          const val = obj[key];
          const full = basePath ? basePath + '/' + key : key;
          const isFile = !!val.__file;
          const item = document.createElement('div');
          item.className = 'tree-item';
          item.innerHTML = isFile ? `üìÑ <span>${key}</span>` : `üìÅ <span>${key}</span>`;
          container.appendChild(item);

          if(isFile){
            item.addEventListener('click',()=> openFile(val.__file));
          } else {
            const child = makeNode(val, full);
            container.appendChild(child);
          }
        }
        return container;
      }

      const wrapper = document.createElement('div');
      wrapper.appendChild(makeNode(root));
      treeEl.appendChild(wrapper);
    }

    async function openFile(file){
      try{
        const url = `${rawBase(owner, repo, branch)}/${file.path}`;
        const res = await fetch(url);
        const text = await res.text();
        $('#activePath').textContent = file.path;
        const code = $('#code');
        code.className = 'language-' + extToLang(file.path);
        code.textContent = text;
        hljs.highlightElement(code);
        try { hljs.lineNumbersBlock(code); } catch {}
        $('#error').style.display='none';
      }catch(err){
        const e = $('#error');
        e.style.display='block';
        e.textContent = 'Error: ' + err.message;
      }
    }

    (async ()=>{
      const files = await listTree();
      const allowed = files.filter(f => /\.(cs|json|md|shader|hlsl|cginc|txt)$/i.test(f.path));
      renderTree(allowed);
      if(allowed[0]) openFile(allowed[0]);
    })();
  </script>
</body>
</html>
